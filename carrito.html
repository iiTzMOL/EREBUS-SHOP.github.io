<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carrito - EREBUS</title>
<style>
:root{
  --color-primary:#000;
  --color-accent:#e0e0e0;
  --color-danger:#dc3545;
  --color-success:#28a745;
  --font-title:'Segoe UI', sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial, sans-serif;background:#fff;color:#333;padding-top:100px}
header{position:fixed;top:0;left:0;width:100%;background:#000;color:#fff;padding:15px;z-index:1000;text-align:center}
header h1{margin:0;font-size:1.5rem}
nav ul{list-style:none;display:flex;justify-content:center;gap:20px;padding:10px 0;background:var(--color-primary);}
nav a{color:var(--color-background);text-decoration:none;font-weight:500;font-size:1rem;padding:5px 0;}
nav a.active{color:#e0e0e0;border-bottom:2px solid var(--color-accent);}
.container{max-width:1100px;margin:auto;padding:20px}
.page-title{text-align:center;font-size:2rem;margin-bottom:20px}
.cart-layout{display:grid;grid-template-columns:2fr 1fr;gap:20px}
@media(max-width:768px){.cart-layout{grid-template-columns:1fr}}
.cart-section{border:1px solid var(--color-accent);border-radius:10px;padding:20px;background:#fff}
.section-title{margin-bottom:15px;font-size:1.2rem;border-bottom:1px solid var(--color-accent);padding-bottom:5px}
.cart-item{display:flex;gap:15px;border-bottom:1px solid #ddd;padding:15px 0}
.cart-item img{width:80px;height:80px;object-fit:cover;border-radius:6px}
.item-details{flex:1}
.item-name{font-weight:bold}
.item-controls{margin-top:8px;display:flex;gap:10px;align-items:center}
.qty-btn{width:28px;height:28px;border:none;border-radius:50%;background:#000;color:#fff;cursor:pointer}
.qty-input{width:40px;text-align:center}
.remove-item{color:var(--color-danger);cursor:pointer;font-size:0.9rem}
.summary-row{display:flex;justify-content:space-between;margin-bottom:10px}
.summary-row.total{font-weight:bold;border-top:1px solid var(--color-accent);padding-top:10px}
.payment-option{border:2px solid var(--color-accent);border-radius:8px;padding:10px;margin-bottom:10px;cursor:pointer}
.payment-option.active{border-color:#000;background:#f9f9f9}
#stripe-card-element{margin:10px 0;padding:10px;border:1px solid #ccc;border-radius:6px}
#paypal-button-container, #mercadopago-button{margin-top:10px}
.btn{display:block;width:100%;padding:12px;border:none;border-radius:6px;font-size:1rem;cursor:pointer}
.btn-primary{background:#000;color:#fff}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);justify-content:center;align-items:center}
.modal-content{background:#fff;padding:30px;border-radius:10px;text-align:center}
</style>
</head>
<body>
<header>
  <h1>EREBUS - Carrito</h1>
  <nav>
    <ul>
      <li><a href="index.html">Inicio</a></li>
      <li><a href="index.html#ropa">Ropa</a></li>
      <li><a href="perfumes.html">Perfumes</a></li>
      <li><a href="carrito.html" class="active">Carrito</a></li>
      <li><a href="index.html#contacto">Contacto</a></li>
    </ul>
  </nav>
</header>
<div class="container">
  <h2 class="page-title">Carrito de Compras</h2>
  <div class="cart-layout">
    <!-- Productos -->
    <div class="cart-section">
      <h3 class="section-title">Tus Productos</h3>
      <div id="cartItems"></div>
      <div id="cartEmpty" style="display:none;text-align:center;padding:20px;">
        <p>Tu carrito está vacío.</p>
        <a href="index.html" class="btn btn-primary">Volver a la tienda</a>
      </div>
    </div>
    <!-- Resumen -->
    <div class="cart-section">
      <h3 class="section-title">Resumen</h3>
      <div class="summary-row"><span>Subtotal:</span><span id="subtotal">$0.00</span></div>
      <div class="summary-row"><span>Envío:</span><span id="shipping">$99.00</span></div>
      <div class="summary-row"><span>IVA (16%):</span><span id="tax">$0.00</span></div>
      <div class="summary-row total"><span>Total:</span><span id="total">$0.00</span></div>
    </div>
  </div>
</div>
<!-- Modal confirmación -->
<div id="confirmationModal" class="modal">
  <div class="modal-content">
    <h2>¡Pago exitoso!</h2>
    <p>Número de orden: <span id="orderNumber"></span></p>
    <button class="btn btn-primary" onclick="closeConfirmationModal()">Cerrar</button>
  </div>
</div>
<script>
// Carrito
class SecureCartManager {
  constructor() {
    this.cart = this.loadCart();
    this.shippingCost = 99.00;
    this.taxRate = 0.16;
    this.init();
  }
  init() {
    this.renderCart();
    this.updateSummary();
  }
  loadCart() {
    try {
      const savedCart = JSON.parse(localStorage.getItem('erebus_cart') || '[]');
      return Array.isArray(savedCart) ? savedCart : [];
    } catch (e) {
      return [];
    }
  }
  saveCart() {
    try {
      localStorage.setItem('erebus_cart', JSON.stringify(this.cart));
    } catch (e) {}
  }
  removeFromCart(itemId) {
    this.cart = this.cart.filter(item => item.id !== itemId);
    this.saveCart();
    this.renderCart();
    this.updateSummary();
  }
  updateQuantity(itemId, newQuantity) {
    if (newQuantity <= 0) {
      this.removeFromCart(itemId);
      return;
    }
    const item = this.cart.find(item => item.id === itemId);
    if (item) {
      item.quantity = parseInt(newQuantity);
      this.saveCart();
      this.renderCart();
      this.updateSummary();
    }
  }
  getSubtotal() {
    return this.cart.reduce((sum, item) => {
      const price = parseFloat(item.price) || 0;
      const quantity = parseInt(item.quantity) || 0;
      return sum + (price * quantity);
    }, 0);
  }
  getTax() {
    return this.getSubtotal() * this.taxRate;
  }
  getTotal() {
    const subtotal = this.getSubtotal();
    const tax = this.getTax();
    const shipping = this.cart.length > 0 ? this.shippingCost : 0;
    return subtotal + tax + shipping;
  }
  renderCart() {
    const cartItemsContainer = document.getElementById('cartItems');
    const cartEmptyContainer = document.getElementById('cartEmpty');
    if (!cartItemsContainer || !cartEmptyContainer) return;
    if (this.cart.length === 0) {
      cartItemsContainer.innerHTML = '';
      cartEmptyContainer.style.display = 'block';
      return;
    }
    cartEmptyContainer.style.display = 'none';
    try {
      cartItemsContainer.innerHTML = this.cart.map(item => {
        const price = parseFloat(item.price) || 0;
        const quantity = parseInt(item.quantity) || 0;
        const name = item.name || 'Producto sin nombre';
        const variant = item.variant || 'N/A';
        const image = item.image || 'images/placeholder.png';
        const id = item.id || Date.now();
        return `
          <div class="cart-item">
            <img src="${image}" alt="${name}" class="item-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik01MCAzNUM0MS43IDM1IDM1IDQxLjcgMzUgNTBTNDEuNyA2NSA1MCA2NVM2NSA1OC4zIDY1IDUwUzU4LjMgMzUgNTAgMzVaIiBmaWxsPSIjOUI5Qjk5Ii8+Cjwvc3ZnPgo='">
            <div class="item-details">
              <h3 class="item-name">${name}</h3>
              <p class="item-variant">${variant}</p>
              <p class="item-price">${price.toFixed(2)}</p>
              <div class="item-controls">
                <div class="quantity-control">
                  <button class="qty-btn" onclick="cartManager.updateQuantity(${id}, ${quantity - 1})" ${quantity <= 1 ? 'disabled' : ''}>-</button>
                  <input type="number" class="qty-input" value="${quantity}" min="1" 
                         onchange="cartManager.updateQuantity(${id}, parseInt(this.value) || 1)">
                  <button class="qty-btn" onclick="cartManager.updateQuantity(${id}, ${quantity + 1})">+</button>
                </div>
                <span class="remove-item" onclick="cartManager.removeFromCart(${id})">Eliminar</span>
              </div>
            </div>
          </div>
        `;
      }).join('');
    } catch (e) {
      cartItemsContainer.innerHTML = '<p>Error al cargar los productos del carrito.</p>';
    }
  }
  updateSummary() {
    const subtotal = this.getSubtotal();
    const tax = this.getTax();
    const shipping = this.cart.length > 0 ? this.shippingCost : 0;
    const total = this.getTotal();
    const subtotalEl = document.getElementById('subtotal');
    const taxEl = document.getElementById('tax');
    const shippingEl = document.getElementById('shipping');
    const totalEl = document.getElementById('total');
    if (subtotalEl) subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
    if (taxEl) taxEl.textContent = `$${tax.toFixed(2)}`;
    if (shippingEl) shippingEl.textContent = shipping > 0 ? `$${shipping.toFixed(2)}` : 'Gratis';
    if (totalEl) totalEl.textContent = `$${total.toFixed(2)}`;
  }
}
function closeConfirmationModal() {
  document.getElementById('confirmationModal').style.display = 'none';
  window.location.href = 'index.html';
}
const cartManager = new SecureCartManager();
</script>
</body>
</html>
